<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClutterFreeSpaces Newsletter Signup</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        .newsletter-form-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .newsletter-form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #7c3aed, #dc2626);
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .montana-badge {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .headline-a {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.2;
            margin-bottom: 12px;
        }

        .headline-b {
            font-size: 26px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.2;
            margin-bottom: 12px;
        }

        .subheadline {
            font-size: 16px;
            color: #6b7280;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .newsletter-form {
            display: grid;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .required {
            color: #dc2626;
        }

        input[type="text"],
        input[type="email"],
        select {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: white;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 14px;
            line-height: 1.4;
            color: #4b5563;
            cursor: pointer;
            flex: 1;
        }

        .privacy-link {
            color: #2563eb;
            text-decoration: none;
        }

        .privacy-link:hover {
            text-decoration: underline;
        }

        .lead-score-indicator {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 15px 0;
            display: none;
        }

        .lead-score-indicator.show {
            display: block;
        }

        .score-label {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .score-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .score-fill {
            height: 100%;
            border-radius: 4px;
            transition: all 0.3s ease;
            width: 0%;
        }

        .score-low { background: #ef4444; }
        .score-medium { background: #f59e0b; }
        .score-high { background: #10b981; }

        .submit-button {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .submit-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
        }

        .submit-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .success-message,
        .error-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .success-message {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .error-message {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .loading-spinner {
            display: none;
            margin-left: 10px;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 640px) {
            .newsletter-form-container {
                margin: 10px;
                padding: 20px 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .headline-a,
            .headline-b {
                font-size: 24px;
            }

            input[type="text"],
            input[type="email"],
            select {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        /* A/B Test Variations */
        .variation-b .headline-a { display: none; }
        .variation-a .headline-b { display: none; }
    </style>
</head>
<body>
    <div class="newsletter-form-container" id="newsletterContainer">
        <div class="form-header">
            <div class="montana-badge">Montana RV Experts</div>
            <h1 class="headline-a">Transform Your RV Into a Clutter-Free Paradise</h1>
            <h1 class="headline-b">Discover 7 Proven Secrets to RV Organization That Actually Work</h1>
            <p class="subheadline">Join 2,500+ RV owners getting weekly tips, exclusive guides, and Montana-tested solutions delivered to your inbox.</p>
        </div>

        <form class="newsletter-form" id="newsletterForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="rvType">Your RV Type</label>
                    <select id="rvType" name="rvType">
                        <option value="">Select your RV type...</option>
                        <option value="class-a">Class A Motorhome</option>
                        <option value="class-b">Class B Van/Camper</option>
                        <option value="class-c">Class C Motorhome</option>
                        <option value="travel-trailer">Travel Trailer</option>
                        <option value="fifth-wheel">Fifth Wheel</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timeline">When do you need solutions?</label>
                    <select id="timeline" name="timeline">
                        <option value="">Select timeline...</option>
                        <option value="asap">ASAP - I'm overwhelmed!</option>
                        <option value="within-month">Within the next month</option>
                        <option value="2-3-months">2-3 months from now</option>
                        <option value="exploring">Just exploring options</option>
                    </select>
                </div>
            </div>

            <div class="form-group full-width">
                <label for="biggestChallenge">What's your biggest organization challenge?</label>
                <select id="biggestChallenge" name="biggestChallenge">
                    <option value="">Select your biggest challenge...</option>
                    <option value="kitchen">Kitchen & Pantry Organization</option>
                    <option value="bedroom">Bedroom & Closet Space</option>
                    <option value="storage-bays">External Storage Bays</option>
                    <option value="weight-management">Weight & Space Management</option>
                    <option value="seasonal-gear">Seasonal Gear Storage</option>
                </select>
            </div>

            <div class="form-group full-width">
                <div class="checkbox-group">
                    <input type="checkbox" id="montanaResident" name="montanaResident" value="yes">
                    <label for="montanaResident" class="checkbox-label">
                        I'm a Montana resident (get exclusive local tips!)
                    </label>
                </div>
            </div>

            <div class="lead-score-indicator" id="leadScore">
                <div class="score-label">Profile Completion</div>
                <div class="score-bar">
                    <div class="score-fill" id="scoreFill"></div>
                </div>
            </div>

            <div class="form-group full-width">
                <div class="checkbox-group">
                    <input type="checkbox" id="gdprConsent" name="gdprConsent" required>
                    <label for="gdprConsent" class="checkbox-label">
                        I agree to receive emails from ClutterFreeSpaces and understand I can unsubscribe at any time. 
                        View our <a href="#" class="privacy-link">Privacy Policy</a>.
                    </label>
                </div>
            </div>

            <button type="submit" class="submit-button" id="submitButton">
                Get My Free Organization Guide
                <div class="loading-spinner" id="loadingSpinner"></div>
            </button>

            <div class="success-message" id="successMessage">
                Welcome aboard! Check your email for your free organization guide and weekly tips.
            </div>

            <div class="error-message" id="errorMessage">
                Oops! Something went wrong. Please try again or contact us directly.
            </div>
        </form>
    </div>

    <script>
        // A/B Test Implementation
        function initABTest() {
            const variation = Math.random() < 0.5 ? 'a' : 'b';
            document.getElementById('newsletterContainer').classList.add(`variation-${variation}`);
            
            // Track variation for analytics
            window.newsletterVariation = variation;
        }

        // Lead Scoring System
        const scoring = {
            rvType: {
                'class-a': 25,
                'class-b': 15,
                'class-c': 20,
                'travel-trailer': 15,
                'fifth-wheel': 20,
                'other': 10
            },
            biggestChallenge: {
                'kitchen': 20,
                'bedroom': 15,
                'storage-bays': 25,
                'weight-management': 30,
                'seasonal-gear': 15
            },
            timeline: {
                'asap': 40,
                'within-month': 30,
                '2-3-months': 20,
                'exploring': 10
            },
            montanaResident: 15,
            hasEmail: 10,
            hasName: 5
        };

        function calculateLeadScore() {
            let score = 0;
            let maxScore = 100;

            const formData = new FormData(document.getElementById('newsletterForm'));
            
            // Basic info scoring
            if (formData.get('firstName')?.trim()) score += scoring.hasName;
            if (formData.get('email')?.trim()) score += scoring.hasEmail;

            // RV Type scoring
            const rvType = formData.get('rvType');
            if (rvType && scoring.rvType[rvType]) {
                score += scoring.rvType[rvType];
            }

            // Challenge scoring
            const challenge = formData.get('biggestChallenge');
            if (challenge && scoring.biggestChallenge[challenge]) {
                score += scoring.biggestChallenge[challenge];
            }

            // Timeline scoring
            const timeline = formData.get('timeline');
            if (timeline && scoring.timeline[timeline]) {
                score += scoring.timeline[timeline];
            }

            // Montana resident bonus
            if (formData.get('montanaResident')) {
                score += scoring.montanaResident;
            }

            return Math.min(score, maxScore);
        }

        function updateLeadScoreDisplay() {
            const score = calculateLeadScore();
            const scoreIndicator = document.getElementById('leadScore');
            const scoreFill = document.getElementById('scoreFill');

            if (score > 15) { // Show after some basic info
                scoreIndicator.classList.add('show');
                
                scoreFill.style.width = score + '%';
                
                // Update color based on score
                scoreFill.className = 'score-fill ';
                if (score < 40) scoreFill.classList.add('score-low');
                else if (score < 70) scoreFill.classList.add('score-medium');
                else scoreFill.classList.add('score-high');
            } else {
                scoreIndicator.classList.remove('show');
            }

            return score;
        }

        // Form submission handler
        async function handleFormSubmission(event) {
            event.preventDefault();

            const submitButton = document.getElementById('submitButton');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');

            // Reset messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            // Show loading state
            submitButton.disabled = true;
            loadingSpinner.style.display = 'inline-block';

            try {
                const formData = new FormData(event.target);
                const leadScore = calculateLeadScore();
                
                const payload = {
                    firstName: formData.get('firstName'),
                    email: formData.get('email'),
                    rvType: formData.get('rvType'),
                    biggestChallenge: formData.get('biggestChallenge'),
                    timeline: formData.get('timeline'),
                    montanaResident: formData.get('montanaResident') === 'yes',
                    gdprConsent: formData.get('gdprConsent') === 'on',
                    leadScore: leadScore,
                    abTestVariation: window.newsletterVariation,
                    timestamp: new Date().toISOString(),
                    source: 'newsletter_signup_form'
                };

                const response = await fetch('/api/newsletter-signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    successMessage.style.display = 'block';
                    event.target.reset();
                    document.getElementById('leadScore').classList.remove('show');
                    
                    // Track conversion
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'conversion', {
                            'send_to': 'AW-CONVERSION_ID/CONVERSION_LABEL',
                            'value': leadScore,
                            'currency': 'USD'
                        });
                    }
                } else {
                    throw new Error('Network response was not ok');
                }

            } catch (error) {
                console.error('Form submission error:', error);
                errorMessage.style.display = 'block';
            } finally {
                submitButton.disabled = false;
                loadingSpinner.style.display = 'none';
            }
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            initABTest();

            const form = document.getElementById('newsletterForm');
            form.addEventListener('submit', handleFormSubmission);

            // Add event listeners for lead scoring
            const scoringFields = ['firstName', 'email', 'rvType', 'biggestChallenge', 'timeline', 'montanaResident'];
            scoringFields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                if (field) {
                    field.addEventListener('input', updateLeadScoreDisplay);
                    field.addEventListener('change', updateLeadScoreDisplay);
                }
            });

            // Initial score calculation
            updateLeadScoreDisplay();
        });

        // Export for external access
        window.ClutterFreeSpacesForm = {
            getLeadScore: calculateLeadScore,
            getVariation: () => window.newsletterVariation
        };
    </script>
</body>
</html>